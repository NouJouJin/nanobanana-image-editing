# nano banana ローカル画像一括編集ツール

## 1. 概要
このツールは、GoogleのAIモデル「Gemini」を利用して、ローカルPC上の画像をテキスト指示（プロンプト）で一括編集するためのPythonスクリプトです。

参考画像を用いたスタイルの適用や、ロゴの当て込みなど、高度な画像編集を自動化できます。

## 2. 主な機能
-   **一括画像処理**: `input_images`フォルダに入れた画像をまとめて編集し、`output_images`フォルダに保存します。
-   **参考画像の利用**: `reference_images`フォルダの画像をスタイルや要素の参考にさせることができます。
-   **日本語プロンプト対応 (自動翻訳機能)**: 指示を日本語で書くと、高性能なGemini 1.5 Proモデルが自動で高品質な英語に翻訳してから画像生成モデルに渡すため、AIへの指示がより正確に伝わります。
-   **出力サイズの安定化**: 参考画像のサイズが出力に影響を与えないよう、入力画像のサイズを基準に処理を行う対策が施されています。

## 3. セットアップ手順
### Step 1: 必要なものを準備する
-   **Python 3.8以上**
-   **Google AI APIキー**:
    1. [Google AI Studio](https://aistudio.google.com/)にアクセスし、Googleアカウントでログインします。
    2. `Get API key` をクリックし、新しいAPIキーを作成します。
    3. 表示されたAPIキーをコピーしておきます。**このキーは絶対に他人に教えたり、公開したりしないでください。**
    4. **課金設定を有効にする**: APIの利用は有料です。Google Cloudプロジェクトで[課金を有効](https://cloud.google.com/billing/docs/how-to/enable-billing)にする必要があります。

### Step 2: ライブラリをインストールする
お使いのPCのターミナル（WindowsならコマンドプロンプトやPowerShell）を開き、以下のコマンドを実行して必要なライブラリをインストールします。
```bash
pip install -U google-generativeai python-dotenv Pillow
```

### Step 3: プロジェクトを準備する
1.  このスクリプト (`process_images.py`) をPCの好きな場所に保存します。
2.  スクリプトと同じ場所に、以下の**3つのフォルダ**を新しく作成します。
    -   `input_images`: 編集したい画像を入れる場所です。
    -   `output_images`: 編集後の画像が自動で保存される場所です。
    -   `reference_images`: スタイルやロゴの参考画像を入れる場所です。
3.  スクリプトと同じ場所に `.env` という名前のファイルを新規作成し、以下の内容を記述して保存します。
    ```
    GOOGLE_API_KEY="ここにあなたのAPIキーを貼り付け"
    ```
4.  （推奨）もしこのフォルダをGitで管理する場合は、`.gitignore`ファイルも作成し、`.env` と書き込んでおくと、誤ってAPIキーをアップロードしてしまう事故を防げます。

## 4. 使い方
1.  **画像を準備する**:
    -   編集したい画像を `input_images` フォルダに入れます。
    -   （必要であれば）参考画像を `reference_images` フォルダに入れます。
2.  **スクリプトを編集する**:
    -   `process_images.py` ファイルをテキストエディタで開き、上部にある **`--- ユーザー設定エリア ---`** の内容を書き換えます。
    -   `PROMPT_TEXT_JP`: AIへの指示を**日本語で**具体的に書きます。
    -   `REFERENCE_IMAGE_NAME`: 使用する参考画像のファイル名を書きます。使わない場合は `""`（空文字列）にしてください。
3.  **スクリプトを実行する**:
    -   ターミナルでこのスクリプトがあるフォルダに移動し、以下のコマンドを実行します。
    ```bash
    python process_images.py
    ```
4.  **結果を確認する**:
    -   処理が完了すると、`output_images` フォルダに `元のファイル名_edited.png` という名前で編集後の画像が保存されます。

## 5. 利用上の注意点【重要】
このツールを安全で快適に利用するために、以下の点に必ずご注意ください。

### ファイル名について
-   **英数字で設定**: `input_images` や `reference_images` に入れる画像のファイル名は、**日本語や全角文字、特殊記号を含まない半角英数字**（例: `photo_01.jpg`, `logo_for_tablet.png`）にしてください。日本語等のファイル名は、予期せぬエラーの原因となることがあります。

### APIキーの厳重な管理
-   `.env` ファイルに記述したAPIキーは、あなたの**大変重要な機密情報**です。
-   このフォルダを誰かと共有したり、GitHubなどで公開したりする際は、必ず `.env` ファイルが含まれていないことを確認してください。

### よくあるエラーとその対処法
-   **モデルが見つからないエラー (`404 models/... is not found`)**:
    -   **原因**: Google側でモデル名が変更されたり、利用しているモデルが非推奨になったりした場合に発生します。
    -   **対処法**: スクリプト内の `genai.GenerativeModel(...)` で指定されているモデル名を、`gemini-1.5-flash-latest` や `gemini-1.5-pro-latest` のような、現在推奨されている安定版名前に変更してみてください。
-   **画像が生成されないエラー (`レスポンスに画像データが含まれていませんでした` / `list index out of range`)**:
    -   **原因**: Googleの**セーフティフィルター**が作動した可能性が最も高いです。特に、実在の人物と思われる顔を大きく変更する指示、特定のブランドロゴの削除・変更、その他Googleのポリシーに抵触する可能性のある内容はブロックされることがあります。
    -   **対処法**:
        1.  **原因の切り分け**が重要です。まずはプロンプトを「この画像をアニメ風にして」のような非常にシンプルなものに変えて試します。
        2.  それでも失敗する場合は、入力画像や参考画像を、著作権フリーの風景や物の写真に変えて試します。
        3.  上記で問題の原因（プロンプトか、画像か）を特定し、元のプロンプトや画像を少しずつ調整して再度お試しください。

### API利用料金について
-   本ツールの利用には、実行ごとにGoogle CloudのAPI利用料金が発生します。意図せず高額な請求が発生しないよう、利用量には十分ご注意ください。料金の詳細は[Geminiモデルの公式料金ページ](https://cloud.google.com/vertex-ai/pricing#gemini)をご確認ください。